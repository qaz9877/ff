<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <!-- 引入 Bootstrap 样式文件 -->
    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
  --font-size: 15px; /* 定义字体大小的自定义变量 */
}


  body {
        margin: 0; /* 清除页面默认的外边距 */
        padding: 0; /* 清除页面默认的内边距 */
        font-family: Arial, sans-serif; /* 设置字体 */
        background-color: #f0f0f0; /* 设置背景颜色 */
        color: #333; /* 设置文字颜色 */
        font-size: var(--font-size); /* 应用字体大小自定义变量到 body 元素 */
        /* line-height: 1.6; 设置行高 */
    }
    button {
            font-size: 6px;
        }
        .left {
        float: left;
        padding: 14px 16px;
        }
        .right {
        overflow: hidden;
        display: block;
        /* text-align: center; */
        padding: 14px 16px;
        text-decoration: none;
        /* height: 800px; */
        }
        input {
        width: 100%;
        box-sizing: border-box; /* 包括内边距和边框在内的总宽度不超过容器的宽度 */
    }
        #dynamicTable thead {
        width: 100%; /* 设置thead的宽度为100% */
        height: 50px; /* 设置表头高度 */
        background-color: #343a40; /* 设置表头背景颜色 */
        color: #fff; /* 设置表头文字颜色 */
        /* font-weight: bold; 设置表头文字加粗 */

        
    }
    .placeholder {
        width: 60px; /* 设置宽度 */
        height: 100px; /* 设置高度为200像素 */
        background-image: url('/static/OIP-C.jpg'); /* 设置背景图片的 URL */
        background-size: cover; /* 使背景图片填充整个容器 */
        background-position: center; /* 居中显示背景图片 */
    }
    .placeholder2 {
        width: 100px; /* 设置宽度 */
        height: 300px; /* 设置高度为200像素 */
    }
    /* 设置表格的边框和内边距 */
    #dynamicTable th, #dynamicTable td {
        border: 1px solid #dee2e6; /* 设置单元格边框 */
        padding: 8px; /* 设置单元格内边距 */
        text-align: center; /* 文字居中对齐 */
    }

    /* #dynamicTable td:nth-child(4){
        width:60px;
    }
    #dynamicTable td:nth-child(6){
        width:60px;
    }
    #dynamicTable td:nth-child(1){
        width:30px;
    }*/
     #dynamicTable td:nth-child(12){
        width:30px;
    }  
    .container {
        display: flex; /* 使用 Flexbox 布局 */
        justify-content: space-between; /* 将元素分散对齐 */
        align-items: center; /* 垂直居中对齐 */
    }
    input {

             text-align: right; /* 设置输入框中文本右对齐 */
          
            box-sizing: border-box; /* 包含边框和内边距在内的元素框的宽度和高度 */
        }
    #dynamicTable input {
        width: 100%;
        height: 100%;
        flex: 1;
        /* 让输入框占据剩余空间 */
        /* width: 300px; 使输入框占满容器的宽度 */
        /* text-align: right; */
  }
  .tr-container {
           /*  direction: rtl; 设置容器内文本方向为从右向左 */
            /* margin: 0 auto; 将输入框容器水平居中 */
        }
    </style>
</head>
<body>
    <!-- <div class="container mt-5"> -->
    <div class="row">
        <div class="col-md-1 left table-bordered" >
            <div class=" bg-light p-3 ">
                <div class="placeholder"></div>
                <div class="placeholder2"></div>
                <h1  class="mb-1"></h1>
               
                <button class="btn btn-primary mb-2" onclick="showHTMLContent()">主页</button><br>
                <!-- <button class="btn btn-primary mb-2" onclick="showCSSContent()">空的</button><br>
                <button class="btn btn-primary mb-2" onclick="showJSContent()">空的</button> -->
            </div>
           
        </div>
        <div class="col-md-11 right"  id="content" data-spy="scroll">
             <div id="myDiv" style="display:none">  
            
                        <button id="sendTasksBtn" class="btn btn-primary">发送任务</button>
                        <button id="Cleartask" class="btn btn-primary">清空任务</button>
                        <button id="detemine" class="btn btn-primary">确定目录地址</button>
                        <div id="ifo" class="text-danger"></div>
                        <table>
                            <!-- 表头行 -->
                            <tr>
                                <th> <div class="form-group  container">
                             
                                    <div for="audio_address" class="col-sm-3 control-label">音频目录地址</div>
                                    <div class="col-sm-9">
                                      <input type="text" class="form-control" id="audio_address" placeholder="音频目录地址" value="">
                                    </div>
                                   
                                  </div></th>
                                <th> <div class="form-group  container">
                                    <label for="video_address" class="col-sm-3 control-label">视频目录地址</label>
                                    <div class="col-sm-9">
                                      <input type="text" class="form-control" id="video_address" placeholder="视频目录地址" value="">
                                    </div>
                                   
                                  </div></th>
                            </tr>
                            <!-- 数据行 -->
                            <tr>
                                <td><div class="form-group  container">
                                    <label for="music_address" class="col-sm-3 control-label">音乐目录地址</label>
                                    <div class="col-sm-9">
                                      <input type="text" class="form-control" id="music_address" placeholder="音乐目录地址" value="">
                                    </div> </div></td>
                                <td><div class="form-group  container">
                                    <label for="image_address" class="col-sm-3 control-label">图片目录地址</label>
                                    <div class="col-sm-9">
                                      <input type="text" class="form-control" id="image_address" placeholder="图片目录地址" value="">
                                    </div>
                                 
                                  </div></td>
                            </tr>
                            <tr>
                                <td> <div class="form-group  container">
                                    <label for="text_address" class="col-sm-3 control-label">主题目录地址</label>
                                    <div class="col-sm-9">
                                      <input type="text" class="form-control" id="text_address" placeholder="主题目录地址" value="">
                                    </div>
                                    
                                  </div></td>
                                <td></td>
                            </tr>
                        </table>
                       
                         
                        <button class="btn btn-sm btn-primary" onclick="openDirectoryPicker2()">选择视频目录</button> 
                        <button class="btn btn-sm btn-primary" onclick="openDirectoryPicker1()">选择音频目录</button><button class=" btn btn-sm btn-primary" onclick="clearDirectoryPicker2()">清空</button>   
                        <button class="btn btn-sm btn-primary" onclick="openDirectoryPicker4()">选择音乐目录</button><button class="btn btn-sm btn-primary" onclick="clearDirectoryPicker4()">清空</button>
                        <button class="btn btn-sm btn-primary" onclick="openDirectoryPicker5()">选择图片目录</button><button class="btn btn-sm btn-primary" onclick="clearDirectoryPicker5()">清空</button> 
                        <button class="btn btn-sm btn-primary" onclick="openDirectoryPicker6()">选择主题目录</button><button class="btn btn-sm btn-primary" onclick="clearDirectoryPicker6()">清空</button>
                
                
                <div id="taskStatus" class="mt-4">
                    <!-- Task status will be displayed here -->
                    <table id="dynamicTable" class="table table-bordered">
                        <thead class="table table-bordered table-striped">
                            <tr>
                            <th scope="col">编号</th>
                            <th scope="col">视频</th>
                            <th scope="col">音频</th>
 
                            <th scope="col">音量比例</th>
                            <th scope="col">音乐</th>
                            <th scope="col">音量比例</th>
                            <th scope="col">图片</th>
                            <th scope="col">主题</th>
                            <th scope="col">文字大小</th>
                            <th scope="col">文字样式</th>
                            <th scope="col">进度</th>
                            <th scope="col">重发</th>
                            </tr>
                        </thead>
                        <tbody>
                          
                            <!-- Add more rows as needed -->
                        </tbody>
                        </table>
            </div>
            </div>
            <div  id="content1" style="display:none">
                <h2>CSS 内容</h2>
                <p>这是 CSS 页面的内容。</p>
            </div>
            <div  id="content2" style="display:none">
                <h2>JavaScript 内容</h2>
                <p>这是 JavaScript 页面的内容。</p>
            </div>
        </div>
    </div>
    </div>

    <!-- 引入 Bootstrap 的 JavaScript 文件 -->
    <script src="/static/jquery-3.5.1.slim.min.js"></script>
    <script src="/static/popper.min.js"></script>
    <script src="/static/bootstrap.min.js"></script>
    
    <script>

            // 在页面加载时自动执行
       window.onload = function() {
            showHTMLContent();
        };
        var audio_address
        var video_address 
        var music_address
        var image_address 
        var text_address 

        function clearDirectoryPicker6(){
            var table = document.getElementById("dynamicTable");
            var tbody = table.getElementsByTagName("tbody")[0];
            var rows = tbody.getElementsByTagName("tr");
            const elementsArray = Array.from(rows);
          //  var row = rows[2];
          elementsArray.forEach(row=>{
                var inputs = row.getElementsByTagName("input");
                inputs[4].value=""

            })
          
        }

        function clearDirectoryPicker5(){
            var table = document.getElementById("dynamicTable");
            var tbody = table.getElementsByTagName("tbody")[0];
            var rows = tbody.getElementsByTagName("tr");
            const elementsArray = Array.from(rows);
          //  var row = rows[2];
          elementsArray.forEach(row=>{
                var inputs = row.getElementsByTagName("input");
  

                inputs[3].value=""

            })
          
        }

        function clearDirectoryPicker4(){
            var table = document.getElementById("dynamicTable");
            var tbody = table.getElementsByTagName("tbody")[0];
            var rows = tbody.getElementsByTagName("tr");
            const elementsArray = Array.from(rows);
          //  var row = rows[2];
          elementsArray.forEach(row=>{
                var inputs = row.getElementsByTagName("input");
                inputs[2].value=""

            })
          
        }

        function clearDirectoryPicker2(){
            var table = document.getElementById("dynamicTable");
            var tbody = table.getElementsByTagName("tbody")[0];
            var rows = tbody.getElementsByTagName("tr");
            const elementsArray = Array.from(rows);
          //  var row = rows[2];
          elementsArray.forEach(row=>{
                var inputs = row.getElementsByTagName("input");
                inputs[1].value=""
            })
          
        }
        async function openDirectoryPicker1() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                const iterator = dirHandle.values();
                const directoryName = dirHandle.name;

                let index = countTDs("dynamicTable",3);
                while (true) {
                    const { value, done } = await iterator.next();
                    index++
                    if (done) break;
                    const entry = value;
                    const entryName = entry.name;
                    //const entryPath = entry.isDirectory ? entryName : await entry.getFile().then(file => file.path);
                    listItem = `${entryName}`;
                    addRow(2,listItem,index,"inputone","inputtwo","inputfove","inputfive","inputsix")
                }
            } catch (error) {
                console.error('Error selecting directory:', error);
            }
        }

        async function openDirectoryPicker2() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                const iterator = dirHandle.values();
                const directoryName = dirHandle.name;
                let index =  countTDs("dynamicTable",2);;
                console.log("tttttt")
                while (true) {
                    const { value, done } = await iterator.next();
                    index++
                    if (done) break;

                    const entry = value;
                    const entryName = entry.name;
                    //const entryPath = entry.isDirectory ? entryName : await entry.getFile().then(file => file.path);
                    listItem = `${entryName}`;

                    addRow(1,listItem,index,"inputone","inputtwo","inputfove","inputfive","inputsix")
                }
                //动态绑定button7.addEventListener("click",  send(tbody.children.length + 1));
                var table = document.getElementById("dynamicTable");
                var tbody = table.getElementsByTagName("tbody")[0];
                var rows = tbody.getElementsByTagName("tr");
                console.log("ssssssssssss"+rows.length);
                for (var i = 0; i < rows.length; i++){
                    console.log("绑定",i);;
                    row=rows[i];
                    var button1 = row.getElementsByTagName("button");
                    console.log( button1[0].innerHTML)
                    button1[0].addEventListener("click",send);
                    //button1[0].addEventListener('click', );
                }

            } catch (error) {
                console.error('Error selecting directory:', error);
            }
        }

        async function openDirectoryPicker4() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                const iterator = dirHandle.values();
                const directoryName = dirHandle.name;
                let index = countTDs("dynamicTable",5);
                while (true) {
                    const { value, done } = await iterator.next();
                    index++
                    if (done) break;

                    const entry = value;
                    const entryName = entry.name;
                    //const entryPath = entry.isDirectory ? entryName : await entry.getFile().then(file => file.path);
                    listItem = `${entryName}`;

                    addRow(4,listItem,index,"inputone","inputtwo","inputfove","inputfive","inputsix")
                }
            } catch (error) {
                console.error('Error selecting directory:', error);
            }
        }

        async function openDirectoryPicker5() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                const iterator = dirHandle.values();
                const directoryName = dirHandle.name;
                let index = countTDs("dynamicTable",7);
                while (true) {
                    const { value, done } = await iterator.next();
                    index++
                    if (done) break;

                    const entry = value;
                    const entryName = entry.name;
                    //const entryPath = entry.isDirectory ? entryName : await entry.getFile().then(file => file.path);
                    listItem = `${entryName}`;

                    addRow(6,listItem,index,"inputone","inputtwo","inputfove","inputfive","inputsix")
                }
            } catch (error) {
                console.error('Error selecting directory:', error);
            }
        }

        async function openDirectoryPicker6() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                const iterator = dirHandle.values();
                const directoryName = dirHandle.name;
                let index = countTDs("dynamicTable",8);
                while (true) {
                    const { value, done } = await iterator.next();
                    index++
                    if (done) break;

                    const entry = value;
                    const entryName = entry.name;
                    //const entryPath = entry.isDirectory ? entryName : await entry.getFile().then(file => file.path);
                    listItem = `${entryName}`;

                    addRow(7,listItem,index,"inputone","inputtwo","inputfove","inputfive")
                }
            } catch (error) {
                console.error('Error selecting directory:', error);
            }
        }

        

        document.getElementById("sendTasksBtn").addEventListener("click", function() {
            document.getElementById("ifo").innerText = "";
            var tasks = [];
            var table = document.getElementById("dynamicTable");
            var tbody = table.getElementsByTagName("tbody")[0];
            var rows = tbody.getElementsByTagName("tr");
            
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var inputs = row.getElementsByTagName("input");
                var selects = row.getElementsByTagName("select");
                var tds = row.getElementsByTagName("td");
                // console.log("2222222222")
                // console.log(tds[0].innerHTML)
                var task = {
                    
                    id: parseInt(tds[0].innerHTML),
                    video_address: inputs[0].value,
                    audio_address  : inputs[1].value,
                    audio_volume: parseFloat(selects[0].value),
                    music_address: inputs[2].value,
                    music_volume:  parseFloat(selects[1].value),
                    input_image:inputs[3].value,
                    text_file:inputs[4].value,
                    font_size: parseInt(selects[2].value),
                    font_file:selects[3].value

                };
                // if (inputs[3].value=="")|| (inputs[3].value=="进行中"){
                //     task["progress"]=0
                // }
                if (tds[10]){
                    if (task.audio_address !="" && task.music_address !=""&&task.video_address !=""&&tds[10].innerHTML !="完成"){
                        tasks.push(task);
                        console.log("重复发送")
                        tds[10].innerHTML="进行中"      
                    }else{
                        if(tds[10].innerHTML=="完成"){
                            }else{  
                        tds[10].innerHTML="失败"
                    }
                    }
                }else{
                    if (task.audio_address !="" && task.music_address !=""&&task.video_address !=""){
                        tasks.push(task);
                        tds[10].innerHTML="进行中"
                    }else{
                        tds[10].innerHTML="失败"
                    }
                }
            }
            
            // 将任务发送到后台接口
            fetch('/send-tasks', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(tasks)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络错误：' + response.status);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById("ifo").innerText = "任务发送成功";
                console.log('任务发送成功:', data);
            })
            .catch(error => {
                console.error('错误:', error);
            });
        });

        function send(event){
          // 获取按钮的值
          var valueindex =  parseInt(event.target.innerHTML)-1;
                        // 打印按钮的值
                        console.log("按钮的值是：" + valueindex);
                        //console.log("send"+ event.target.value)
                        document.getElementById("ifo").innerText = "";
                        var tasks = [];
                        var table = document.getElementById("dynamicTable");
                        var tbody = table.getElementsByTagName("tbody")[0];
                        var rows = tbody.getElementsByTagName("tr");
                        var row = rows[valueindex];
                        var inputs = row.getElementsByTagName("input");
                        var selects = row.getElementsByTagName("select");
                        var tds = row.getElementsByTagName("td");
                        var task = {
                            id: parseInt(tds[0].innerHTML),
                            video_address: inputs[0].value,
                            audio_address  : inputs[1].value,
                            audio_volume: parseFloat(selects[0].value),
                            music_address: inputs[2].value,
                            music_volume:  parseFloat(selects[1].value),
                            input_image:inputs[3].value,
                            text_file:inputs[4].value,
                            font_size: parseInt(selects[2].value),
                            font_file:selects[3].value
                        };

                    if (task.audio_address !="" && task.music_address !=""&&task.video_address !=""){
                        tasks.push(task);
                        tds[10].innerHTML="进行中"
                    }else{
                        tds[10].innerHTML="失败"
                    }
                 
            console.log(""+parseInt(tds[0].innerHTML))
            console.log(""+inputs[0].value)
            // 将任务发送到后台接口
            fetch('/send-tasks', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(tasks)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络错误：' + response.status);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById("ifo").innerText = "任务发送成功";
                console.log('任务发送成功:', data);
            })
            .catch(error => {
                console.error('错误:', error);
            });
        }
       
        function checkTaskStatus() {
            fetch("/check-task-status")
                .then(response => response.json())
                .then(data => {
                    // Clear previous status
                    //document.getElementById("taskStatus").innerText = "";

                    // Display status of each task
                    for (let task in data) {
                        let status="";
                        if (data[task].progress ==0){
                            status="进行中";
                        }else if (data[task].progress ==1){
                            status="完成";
                        }else if (data[task].progress ==2){
                            status="失败";
                        }
                        //let status = data[task].Status ? "完成" : "完成中";
                        var columnIndex = task; // 要选择的列索引，这里设置为3
                        var table = document.getElementById("dynamicTable");
                        if (table) {
                            var selector = "tbody tr:nth-child(" + columnIndex + ") td:nth-child(11)";
                                var cell = table.querySelector(selector);
                                if (cell) {
                                    cell.innerHTML = `${status}`;
                                }
                           
                            //console.log(cell);
                        }
                        
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        }
        // setInterval(checkTaskStatus, 10000);
        const socket = new WebSocket("ws://127.0.0.1:8081/ws-endpoint");

        // 处理 WebSocket 连接建立事件
        socket.onopen = function(event) {
            console.log("WebSocket 连接已建立。");
        };

        // 处理 WebSocket 接收消息事件
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            updateTaskStatus(data); // 更新任务状态
        };

        // 处理 WebSocket 连接关闭事件
        socket.onclose = function(event) {
            console.log("WebSocket 连接已关闭。");
        };

        // 处理 WebSocket 连接错误事件
        socket.onerror = function(error) {
            console.error("WebSocket 连接出错:", error);
        };

        // 更新任务状态的函数
        function updateTaskStatus(data) {
            for (let task in data) {
                let status = "";
                if (data[task].progress == 0) {
                    status = "进行中";
                } else if (data[task].progress == 1) {
                    status = "完成";
                } else if (data[task].progress == 2) {
                    status = "失败";
                }
                // 更新页面上对应任务的状态
                var columnIndex = task;
                var table = document.getElementById("dynamicTable");
                if (table) {
                    var selector = "tbody tr:nth-child(" + columnIndex + ") td:nth-child(11)";
                    var cell = table.querySelector(selector);
                    if (cell) {
                        cell.innerHTML = `${status}`;
                    }
                    console.log(cell);
                }
            }
        }

        function getAddress() {
            fetch("/getAddress")
                .then(response => response.json())
                .then(data => {
                    // Clear previous status
                    //document.getElementById("taskStatus").innerText = "";
                    document.getElementById("audio_address").value=data["audio_address"]
                    document.getElementById("video_address").value=data["video_address"]
                    document.getElementById("music_address").value=data["music_address"]
                    document.getElementById("image_address").value=data["image_address"]
                    document.getElementById("text_address").value=data["txt_address"]
                    // Display status of each task
                    console.log(JSON.stringify(data))
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        }

        function getAddressinfo() {
            fetch("/getAddressinfo")
                .then(response => response.json())
                .then(data => {
                    // Clear previous status
                    //document.getElementById("taskStatus").innerText = "";
                    let index = countTDs("dynamicTable",3);
                for (let i=0;i<data.length;i++) {
                    console.log(data.length)
                    index++
                    const entryName =data[i];
                    console.log(entryName)
                    //const entryPath = entry.isDirectory ? entryName : await entry.getFile().then(file => file.path);
                    listItem = `${entryName}`;
                    addRow(2,listItem,index,"inputone","inputtwo","inputfove","inputfive","inputsix")
                }
                    // Display status of each task
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        }

        function getAddressinfo2() {
            fetch("/getAddressinfo2")
                .then(response => response.json())
                .then(data => {
                    // Clear previous status
                    //document.getElementById("taskStatus").innerText = "";
                    let index = countTDs("dynamicTable",8);
                for (let i=0;i<data.length;i++) {
                    console.log(data.length)
                    index++
                    const entryName =data[i];
                    console.log(entryName)
                    //const entryPath = entry.isDirectory ? entryName : await entry.getFile().then(file => file.path);
                    listItem = `${entryName}`;
                    addRow(7,listItem,index,"inputone","inputtwo","inputfove","inputfive","inputsix")
                }
                    // Display status of each task
                })
                .catch(error => {
                    console.error("Error:", error);
                });

                var table = document.getElementById("dynamicTable");
                var tbody = table.getElementsByTagName("tbody")[0];
                var rows = tbody.getElementsByTagName("tr");
                console.log("ssssssssssss"+rows.length);
                for (var i = 0; i < rows.length; i++){
                    console.log("绑定",i);;
                    row=rows[i];
                    var button1 = row.getElementsByTagName("button");
                    console.log( button1[0].innerHTML)
                    button1[0].addEventListener("click",send);
                    //button1[0].addEventListener('click', );
                }
        }

        document.getElementById("Cleartask").addEventListener("click", clearTaskStatus)
        function clearTaskStatus() {
            fetch('/clear-task')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                document.getElementById("ifo").innerText = "任务状态已清空";
                var table = document.getElementById("dynamicTable");
                var tbody = table.getElementsByTagName("tbody")[0]; // 获取第一个 tbody 元素

                // 清除所有 tr 元素
                tbody.innerHTML = "";
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        }
        // Check task status periodically (every 5 seconds)
        document.getElementById("detemine").addEventListener("click", function(){
         audio_address = document.getElementById("audio_address").value;
         video_address = document.getElementById("video_address").value;
         music_address = document.getElementById("music_address").value;
         image_address = document.getElementById("image_address").value;
         text_address = document.getElementById("text_address").value;

         var task = {
            audio_address:audio_address,
            video_address: video_address,
            music_address  : music_address,
            image_address: image_address,
            txt_address: text_address,

                };
         fetch('/updateAddress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(task)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络错误：' + response.status);
                }
                return response.json();
            })
            .then(data => {
                // 清除所有 tr 元素
                document.getElementById("audio_address").value=data["audio_address"]
                document.getElementById("video_address").value=data["video_address"]
                document.getElementById("music_address").value=data["music_address"]
                document.getElementById("image_address").value=data["image_address"]
                document.getElementById("text_address").value=data["txt_address"]
                console.log("得到地址")
                console.log(data)
                document.getElementById("ifo").innerText = "确定地址成功";
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
                document.getElementById("ifo").innerText = "确定地址失败";
            });
        
        })


               

                
     
        setTimeout(function() {
        // 这里写你想要在 3 秒后执行的代码
        getAddress()
        // getAddressinfo() 
        getAddressinfo2()
    }, 1000); // 3000 毫秒 = 3 秒
    setTimeout(function() {
        // 这里写你想要在 3 秒后执行的代码
        getAddress()
        getAddressinfo() 
    }, 3000); // 3000 毫秒 = 3 秒
        //setInterval(getAddress, 3000);
        // getAddress
        
          // 添加行的函数
          function addRow(lie, value, trnum,idname1,idname2,idname3) {
            console.log(1)
            const trCount = document.querySelectorAll('#dynamicTable tbody tr').length;
            if (trnum > trCount) {
                console.log(2)
                const tableBody = document.getElementById('dynamicTable');
                const tbody = tableBody.querySelector('tbody');
                var newRow = document.createElement("tr");
                for (var i = 0; i <= 11; i++) {
                    var cell = document.createElement("td");
                    // 设置每行的编号
                    if (i == 0) {
                        //tr-container
                        cell.classList.add("text_address")
                        cell.textContent = tbody.children.length + 1; // 行号从 1 开始
                    } else if (i == 1) {
                          // 创建输入框
                          cell.classList.add("tr-container")
                            var input = document.createElement("input");
                            // 构建输入框的 ID
                            var inputId = idname1 + trnum;
                            // 设置输入框的 ID
                            input.id = inputId;
                            if (i==lie){
                              
                                input.value=value
                            }
                               // 添加类名
                             input.classList.add("form-control");
                             //input.classList.add("form-control");

                        cell.appendChild(input);
                    }else if(i==2){
                        // 创建输入框
                       
                        cell.classList.add("tr-container")
                        var input = document.createElement("input");
                        // 构建输入框的 ID
                        var inputId = idname2 + trnum;
                        // 设置输入框的 ID
                        input.id = inputId;
                        if (i==lie){
                           
                                input.value=value
                            }
                        // 添加类名
                        input.classList.add("form-control");
                        cell.appendChild(input);
                    }
                    
                    else if(i==3){
                        selectContainer= createSelect(tbody.children.length + 1,"selectoridnameone",16);
                        cell.appendChild(selectContainer)
                    } else if(i==4){
                        // 创建输入框
                        cell.classList.add("tr-container")
                        var input = document.createElement("input");

                        // 构建输入框的 ID
                        var inputId = idname3 + trnum;

                        // 设置输入框的 ID
                        input.id = inputId;
                        if (i==lie){
                                input.value=value
                            }
                        // 添加类名
                        input.classList.add("form-control");

                        cell.appendChild(input);                    
                        
                    }else if(i==5){
                        selectContainer= createSelect(tbody.children.length + 1,"selectoridnametwo",6);
                        cell.appendChild(selectContainer)
                    }else if(i==6){
                        // 创建输入框
                        cell.classList.add("tr-container")
                        var input = document.createElement("input");
                        // 构建输入框的 ID
                        var inputId = idname2 + trnum;
                        // 设置输入框的 ID
                        input.id = inputId;
                        if (i==lie){
                                input.value=value
                            }
                        // 添加类名
                        input.classList.add("form-control");
                        cell.appendChild(input);
                    } else if(i==7){
                        // 创建输入框
                        cell.classList.add("tr-container")
                        var input = document.createElement("input");
                        // 构建输入框的 ID
                        var inputId = idname2 + trnum;
                        // 设置输入框的 ID
                        input.id = inputId;
                        if (i==lie){
                                input.value=value
                            }
                        // 添加类名
                        input.classList.add("form-control");
                        cell.appendChild(input);                        
                    } else if(i==8){
                        selectContainer= createSelect2(tbody.children.length + 1,"selectoridnamethere",5);
                        cell.appendChild(selectContainer)
                    } else if(i==9){
                        selectContainer= createSelect3(tbody.children.length + 1,"selectoridnamefour",6);
                        cell.appendChild(selectContainer)
                    } else if(i==10){
                        cell.classList.add("text-success")
                        cell.innerHTML="" ;  
                    }else if(i==11){
                       // cell.classList.add("")
                        var button7 = document.createElement("button");
                        //var button7 = tbody.children.length + 1;
                        button7.innerHTML = ""+(tbody.children.length + 1);
                        // 设置输入框的 IDbtn-sm
                        button7.classList.add("btn");
                        button7.classList.add("IDbtn-sm");
                        button7.classList.add("btn-primary");
                        button7.id = tbody.children.length + 1;
                         cell.appendChild(button7); 
                        // button7.addEventListener("click",  send(tbody.children.length + 1));   
                    }
                    newRow.appendChild(cell);
                }
                tbody.appendChild(newRow);
                console.log(3)

            //     if (tbody) {
            //     // Iterate over each row in the tbody
            //         tbody.querySelectorAll('tr').forEach((row, rowIndex) => {
                        
            //             xihao=row.querySelectorAll('td')[0].innerHTML;
            //             var button7 = document.createElement("button");
            //             //var button7 = tbody.children.length + 1;
            //             button7.innerHTML = xihao;
            //             // 设置输入框的 ID
            //             button7.id = xihao;
            //             // button.addEventListener('click', () => {
                           
            //             //     });
            //             xihao= parseInt(xihao-1)
            //             row.querySelectorAll('td')[7].appendChild(button7);
            //             button7.addEventListener("click",  send(xihao));
            //             // Iterate over each cell in the row
                      

            //     });
            // }
            }else{
                //console.log(selector)  
                var table = document.getElementById("dynamicTable");
                        if (table) {
                           tempint= parseInt(lie)+1
                            var selector = "tbody tr:nth-child(" + trnum + ") td:nth-child("+tempint+") input";
                            //console.log(selector)    
                            var cell = table.querySelector(selector);
                                if (cell) {
                                    cell.value=value;
                                }
                }
            }
        }
        

    function countTDs(tableId,tempint) {
                var table = document.getElementById(tableId);
                if (!table) {
                    console.error("Table with id '" + tableId + "' not found.");
                    return 0;
                }
                
                var tbody = table.querySelector('tbody');
                if (!tbody) {
                    console.error("Table body not found.");
                    return 0;
                }
                
                var rows = tbody.querySelectorAll('tr');
                var count = 0;
                rows.forEach(function(row) {
                    var firstCell = row.querySelector("td:nth-child("+tempint+") input");
                    if (firstCell) {
                        if (firstCell.value !=""){
                            count++;
                        }
                    
                    }
                });
                
                return count;
                }
    function createSelect3(counter ,selectoridname,defaultOption) {      
        var select = document.createElement("select");
        // 构建选择器的 ID
        var selectId =  selectoridname+ counter;

        // 设置选择器的 ID
        select.id = selectId; 
        var arr=["1.ttf","2.ttf","3.ttf",
    "4.ttf","5.ttf","6.ttf","7.ttf","8.ttf","9.ttf","10.ttf","11.ttf"]
        for(i=0;i<=10;i++){
            const fractionOption = document.createElement('option');
            fractionOption.value = arr[i];
            fractionOption.textContent = arr[i];
            select.appendChild(fractionOption);
        }
        select.selectedIndex  = defaultOption;
        
        return select

    } 
    function createSelect2(counter ,selectoridname,defaultOption) {      
        var select = document.createElement("select");
        // 构建选择器的 ID
        var selectId =  selectoridname+ counter;

        // 设置选择器的 ID
        select.id = selectId;
        for(i=1;i<=10;i++){
            const fractionOption = document.createElement('option');
            fractionOption.value = 10+i*10;
            fractionOption.textContent =10+i*10;
            select.appendChild(fractionOption);
        }
        select.selectedIndex  = defaultOption;
        
        return select

    }  
        // 创建下拉选择器的函数
    function createSelect(counter ,selectoridname,defaultOption) {
    
        // defaultOption=9
        // 创建下拉选择器
        var select = document.createElement("select");

        // 构建选择器的 ID
        var selectId =  selectoridname+ counter;

        // 设置选择器的 ID
        select.id = selectId;
        // 添加类名
        //select.classList.add("form-control");
        //
        // Loop to generate options for fractions
    for (let denominator = 16; denominator >= 1; denominator--) {
        const fraction = 1 / denominator;
        const fractionText = `1/${denominator}`;
        // Create an option element for each fraction
        const fractionOption = document.createElement('option');
        fractionOption.value = fraction;
        fractionOption.textContent = fractionText;
        // Append the option to the select element
        select.appendChild(fractionOption);
    }

    // Loop to generate options for integers
    for (let integer = 2; integer <= 16; integer++) {
        // Create an option element for each integer
        const integerOption = document.createElement('option');
        integerOption.value = integer;
        integerOption.textContent = integer;
        // Append the option to the select element
        select.appendChild(integerOption);
    }
        select.selectedIndex  = defaultOption;
        // 将选择器添加到容器中
        // selectContainer.appendChild(select);

        // // 增加计数器的值
        // counter++;        option.textContent 

        return select
    }
        
    function showHTMLContent() {
        var myDiv = document.getElementById("myDiv");
            if (myDiv) {
                myDiv.style.display = "block"; // 或者 "inline-block"，取决于你想要的显示方式
        };  
        var myDiv1 = document.getElementById("content1");
            if (myDiv1) {
                myDiv1.style.display = "none"; // 或者 "inline-block"，取决于你想要的显示方式
        };
        var myDiv2 = document.getElementById("content2");
            if (myDiv2) {
                myDiv2.style.display = "none"; // 或者 "inline-block"，取决于你想要的显示方式
        };
    }



    function showCSSContent() {
        var myDiv = document.getElementById("content1");
            if (myDiv) {
                myDiv.style.display = "block"; // 或者 "inline-block"，取决于你想要的显示方式
        };
        var myDiv1 = document.getElementById("myDiv");
            if (myDiv1) {
                myDiv1.style.display = "none"; // 或者 "inline-block"，取决于你想要的显示方式
        };  
        var myDiv2 = document.getElementById("content2");
            if (myDiv2) {
                myDiv2.style.display = "none"; // 或者 "inline-block"，取决于你想要的显示方式
        };
    }

    function showJSContent() {
        var myDiv = document.getElementById("content2");
            if (myDiv) {
                myDiv.style.display = "block"; // 或者 "inline-block"，取决于你想要的显示方式
        };
        var myDiv1 = document.getElementById("content1");
            if (myDiv1) {
                myDiv1.style.display = "none"; // 或者 "inline-block"，取决于你想要的显示方式
        };
        var myDiv2 = document.getElementById("myDiv");
            if (myDiv2) {
                myDiv2.style.display = "none"; // 或者 "inline-block"，取决于你想要的显示方式
        };  
    }
    
   
    </script>
</body>
</html>
